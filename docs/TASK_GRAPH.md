# Task Graph Schema

## Overview

The task graph represents the work to be done, organized into tasks with dependencies.

## File Format

Stored as JSON in `swarm1000/data/task_graph.json`.

## Structure

```json
{
  "tasks": [
    {
      "id": "task-0001",
      "area": "backend",
      "title": "Implement REST API endpoint #1",
      "description": "Task in Backend Services epic...",
      "inputs": ["Source code in backend area", "..."],
      "expected_outputs": ["Implemented endpoint", "..."],
      "tests": ["Unit tests pass", "..."],
      "definition_of_done": ["Code implemented and tested", "..."],
      "risk": "medium",
      "deps": ["task-0005"],
      "priority": 7,
      "estimated_minutes": 30,
      "status": "pending",
      "assigned_to": null
    }
  ],
  "epics": {
    "Platform Foundation": ["task-0001", "task-0002", "..."],
    "Backend Services": ["task-0010", "task-0011", "..."]
  }
}
```

## Task Fields

### `id` (string)
Unique task identifier. Format: `task-NNNN` (4-digit zero-padded).

### `area` (string)
Development area. One of:
- `platform` - Core platform services
- `backend` - Backend services
- `frontend` - Frontend applications
- `rust` - Rust/WASM components
- `protocol` - Protocol implementations
- `devops` - DevOps & infrastructure
- `docs` - Documentation
- `design` - Design/UX
- `qa` - Quality assurance
- `security` - Security hardening

### `title` (string)
Short, descriptive task title.

### `description` (string)
Detailed task description with context and requirements.

### `inputs` (array of strings)
Required inputs for the task:
- Source code
- Requirements
- Design specs
- Dependencies

### `expected_outputs` (array of strings)
Expected deliverables:
- Implemented features
- Tests
- Documentation

### `tests` (array of strings)
Test requirements:
- Unit tests
- Integration tests
- Linting

### `definition_of_done` (array of strings)
Checklist for task completion:
- Code implemented
- Tests passing
- Documentation updated
- Code reviewed

### `risk` (string)
Risk level. One of:
- `low` - Straightforward task
- `medium` - Some complexity
- `high` - Complex or risky

### `deps` (array of strings)
Task IDs this task depends on. Must complete before this task can start.

### `priority` (integer)
Priority level 1-10 (higher = more important).

### `estimated_minutes` (integer)
Estimated time to complete (15-60 minutes typical).

### `status` (string)
Current status. One of:
- `pending` - Not started
- `in_progress` - Being worked on
- `completed` - Done
- `failed` - Failed

### `assigned_to` (string or null)
Agent ID assigned to this task (e.g., "agent-0042").

## Epics

Epics group related tasks:

```json
"epics": {
  "Epic Name": ["task-id-1", "task-id-2", ...]
}
```

Standard epics:
1. Platform Foundation
2. Backend Services
3. Frontend Applications
4. Rust/WASM Components
5. Protocol Implementation
6. DevOps & Infrastructure
7. Documentation
8. Design System
9. Quality Assurance
10. Security Hardening

## Dependencies

Tasks form a directed acyclic graph (DAG):
- No cycles allowed
- Dependencies must exist
- Validation catches errors

Example dependency chain:
```
task-0001 (no deps)
   ↓
task-0002 (depends on task-0001)
   ↓
task-0003 (depends on task-0002)
```

## Validation

The task graph is validated for:
1. All dependencies exist
2. No circular dependencies
3. All required fields present

## Usage

### Loading

```python
from swarm1000.core.tasks import TaskGraph

task_graph = TaskGraph.load(Path("task_graph.json"))
```

### Querying

```python
# Get task by ID
task = task_graph.get_task("task-0001")

# Get tasks by area
backend_tasks = task_graph.get_tasks_by_area("backend")

# Get ready tasks (dependencies met)
ready = task_graph.get_ready_tasks(completed_task_ids)
```

### Validation

```python
errors = task_graph.validate_dependencies()
if errors:
    for error in errors:
        print(error)
```

## Generation

Tasks are generated by the planner based on:
- Inventory of projects
- High-level goal
- Agent budget

The planner:
1. Creates epics
2. Distributes tasks across epics
3. Generates task details
4. Adds intra-epic dependencies
5. Adds cross-epic dependencies
6. Validates the graph
