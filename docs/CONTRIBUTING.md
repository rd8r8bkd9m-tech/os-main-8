# Руководство по внесению изменений в Kolibri

## Общие принципы
- Работайте непосредственно в ветке `work` (или `main` при интеграции с центральным репозиторием).
- Используйте [Conventional Commits](https://www.conventionalcommits.org/ru/v1.0.0/) — `feat:`, `fix:`, `docs:`, `chore:`.
- Все обсуждения и описания ведите на русском языке.

## Кодовая база
- C-код следует «Kolibri C11 Standard»: стиль K&R, отступ 4 пробела, идентификаторы на транслитерированном русском (`snake_case`).
- Python-код должен содержать русские docstring-и и комментарии, покрывающие нетривиальные функции.
- Не используйте небезопасные функции ввода (`gets`, небезопасный `scanf`). Предпочитайте проверенный ввод и контроль размеров буферов.

## Тесты и качество
- После правок C/ASM модулей запускайте `make` и `make test`.
- При изменении Python-компонент выполняйте `pytest`, `ruff check .`, `pyright`.
- Для фронтенда (React) используйте `npm run lint` и `npm test` после установки зависимостей.
- Перед пушем убедитесь, что `./kolibri.sh up` завершается без ошибок.

## CI/CD
- GitHub Actions содержит четыре ключевых workflow:
  - `ci.yml` — линтинг, статический анализ, pytest и покрытие кода.
  - `conflict-resolver.yml` — автоматическое устранение конфликтов с помощью `scripts/resolve_conflicts.py` и повторный прогон тестов.
  - `soak.yml` — часовые «соак»-прогоны симуляции с сохранением состояния.
  - `watchdog.yml` — сторож, уведомляющий о сбоях и перезапускающий `soak` при необходимости.
- Для локальной подготовки окружения используйте `scripts/ci_bootstrap.sh`.

## Скрипты
- `scripts/resolve_conflicts.py` — авторазрешение конфликтов с генерацией JSON-отчёта.
- `./build/kolibri_sim soak` — длительные прогоны симуляции Kolibri с накоплением логов (см. `apps/kolibri_sim_cli.c`).
- `scripts/post_pr_comment.py` — добавление комментариев в PR и формирование сторожевых отчётов.
- Все скрипты должны быть исполняемыми (`chmod +x`).

## Документация
- Обновляйте `README.md` и соответствующие файлы в `docs/` при любых изменениях CLI, протоколов или архитектуры.
- Каждое нововведение должно сопровождаться записью в `docs/рабочий_журнал.md` с указанием даты и автора.

## Процесс PR
1. Сформулируйте краткое и детальное описание изменений.
2. Приложите список команд для проверки (раздел «Testing»).
3. Дождитесь зелёного статуса CI.
4. После ревью интегрируйте изменения, не забыв повторно прогнать тесты при ребейзе.

Благодарим за вклад в цифровой разум «Колибри»!
