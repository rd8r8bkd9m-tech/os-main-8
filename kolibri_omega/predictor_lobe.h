#ifndef KOLIBRI_OMEGA_PREDICTOR_LOBE_H
#define KOLIBRI_OMEGA_PREDICTOR_LOBE_H

#include "stubs/kf_pool_stub.h"
#include "include/canvas.h"

/**
 * @file predictor_lobe.h
 * @brief Определение Лоба-Предсказателя (Predictor Lobe).
 *
 * @details
 * Лоб-Предсказатель замыкает один из важнейших циклов познания:
 * "Наблюдение -> Понимание -> Предсказание -> Проверка".
 * Его задача — активно использовать знания (в виде "правил"), накопленные
 * системой, для генерации гипотез о будущем.
 *
 * Принцип работы:
 * 1. Сканирует Холст в поисках "правил" (например, "объекты падают") и
 *    "фактов" (например, "объект Х находится в точке Y").
 * 2. Если находит применимое правило к факту, он генерирует новую
 *    гипотезу-предсказание о том, каким будет следующий факт.
 * 3. Эта гипотеза публикуется на Холст с определенной долей уверенности.
 * 4. Когда Лоб Наблюдения сообщает реальный факт, Наблюдатель может
 *    сравнить его с предсказанием, подтверждая или опровергая правило.
 *    Это создает механизм самокоррекции и обучения.
 */

/**
 * @brief Структура Лоба-Предсказателя.
 */
typedef struct {
    kf_pool_t* formula_pool;   // Доступ к базе знаний для интерпретации правил
    omega_canvas_t* canvas;    // Доступ к Холсту для поиска фактов/правил и публикации предсказаний
    
} omega_predictor_lobe_t;

/**
 * @brief Инициализирует Лоб-Предсказатель.
 * @param lobe Указатель на структуру Лоба.
 * @param pool Указатель на Пул Формул.
 * @param canvas Указатель на Холст.
 */
void omega_predictor_lobe_init(omega_predictor_lobe_t* lobe, kf_pool_t* pool, omega_canvas_t* canvas);

/**
 * @brief Выполняет один цикл работы Лоба-Предсказателя.
 * @details
 * Сканирует Холст. Для каждого "правила" и каждого "факта" проверяет,
 * применимо ли правило к факту. Если да, генерирует предсказание
 * и публикует его на Холст.
 * @param lobe Указатель на Лоб-Предсказатель.
 */
void omega_predictor_lobe_tick(omega_predictor_lobe_t* lobe);

#endif // KOLIBRI_OMEGA_PREDICTOR_LOBE_H
