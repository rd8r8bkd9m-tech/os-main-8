#ifndef KOLIBRI_OMEGA_SOLVER_LOBE_H
#define KOLIBRI_OMEGA_SOLVER_LOBE_H

#include "stubs/kf_pool_stub.h"
#include "stubs/sigma_coordinator_stub.h"
#include "include/canvas.h"

/**
 * @file solver_lobe.h
 * @brief Определение Лоба-Решателя (Solver Lobe).
 *
 * @details
 * Лоб-Решатель — это специализированный когнитивный модуль, который является
 * ключевым элементом в цикле "любопытство -> понимание". Его основная и единственная
 * задача — брать "проблемы" (в виде задач от Координатора) и пытаться их
 * "решить", то есть объяснить.
 *
 * В контексте Фазы 1, "решить" проблему противоречия между двумя фактами
 * (например, "объект был в точке А" и "объект теперь в точке Б") означает
 * создать новую, более общую **формулу-правило**, которая объясняет это
 * изменение (например, "объекты падают").
 *
 * Этот Лоб напрямую взаимодействует с Пулом Формул для создания новых знаний
 * и с Холстом для публикации этих новых знаний.
 */

/**
 * @brief Структура Лоба-Решателя.
 */
typedef struct {
    kf_pool_t* formula_pool;           // Прямой доступ к базе знаний для создания правил
    sigma_coordinator_t* coordinator;  // Доступ к очереди задач
    omega_canvas_t* canvas;            // Доступ к Холсту для публикации новых правил
    
} omega_solver_lobe_t;

/**
 * @brief Инициализирует Лоб-Решатель.
 * @param lobe Указатель на структуру Лоба.
 * @param pool Указатель на Пул Формул.
 * @param coord Указатель на Координатор.
 * @param canvas Указатель на Холст.
 */
void omega_solver_lobe_init(omega_solver_lobe_t* lobe, kf_pool_t* pool, sigma_coordinator_t* coord, omega_canvas_t* canvas);

/**
 * @brief Выполняет один цикл работы Лоба.
 * @details
 * Лоб запрашивает у Координатора следующую задачу. Если задача есть и
 * она предназначена для него (TASK_TYPE_SOLVE_CONTRADICTION), он пытается
 * ее решить:
 * 1. Извлекает из контекста задачи ID противоречащих фактов.
 * 2. Вызывает `kf_create_rule_from_facts` для создания новой формулы-правила.
 * 3. Публикует это новое правило на Холст как гипотезу с высокой уверенностью.
 * 4. Помечает задачу как выполненную.
 * @param lobe Указатель на Лоб-Решатель.
 */
void omega_solver_lobe_tick(omega_solver_lobe_t* lobe);


#endif // KOLIBRI_OMEGA_SOLVER_LOBE_H
