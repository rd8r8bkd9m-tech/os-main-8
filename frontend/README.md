# Kolibri Frontend Layout

## Обзор
- Главный сценарий приложения сосредоточен вокруг нового макета `ChatLayout`, в котором постоянное внимание уделяется колонке диалога.
- Боковая панель бесед реализована как выезжающее меню (мобильное и десктопное состояние управляются пропсами `isSidebarOpen` / `onSidebarOpenChange`).
- Дополнительные разделы (аналитика, знания, swarm, настройки, предпочтения) рендерятся через модальные окна `PanelDialog` и не перегружают основной чат.

## Структура экрана
1. **Сайдбар** — компонент `Sidebar` с лаконичным списком разговоров и кнопкой создания беседы.
2. **Лента сообщений** — компонент `ChatView` с компактным хедером, адаптивными отступами и автопрокруткой.
3. **Инпут и подсказки** — компонент `ChatInput` + панель быстрых подсказок в `App.tsx`.

## Offline и PWA
- `kolibri-sw.js` регистрируется в `main.tsx` и теперь предзагружает `index.html`, `manifest.webmanifest` и `kolibri.svg`, чтобы оболочка UI запускалась без сети.
- Во время сборки формируется локальный FAQ-индекс по `docs/faq.md`; модуль чата использует его как fallback до восстановления соединения.
- При ошибке генерации (например, во время реконнекта) пользователь получает структурированный ответ из оффлайн-FAQ вместо общего уведомления.

## Дополнительные панели
- Компоненты `KnowledgeView`, `SwarmView`, `AnalyticsView`, `KernelControlsPanel`, `ConversationPreferencesBar` отображаются в `PanelDialog`.
- Для мобильного сценария `ChatLayout` блокирует скролл основного документа при открытом сайдбаре.

## Темы и токены
- Цветовые токены определены в `src/styles/tailwind.css` и повторно экспортируются через `tailwind.config.ts`.
- Сохранены алиасы старых токенов (`primary`, `accent`, `background-card` и т.д.), что позволяет использовать их в существующих компонентах.
- Классы `glass-panel`, `glass-panel-strong`, `pill-badge`, `ghost-button` переработаны под минималистичную тему.
- Safe-area отступы вынесены в CSS custom properties (`--safe-area-padding-top`, `--safe-area-sticky-offset`) и подключены как Tailwind-spacing токены (`pt-safe-area-content`, `top-safe-area-sticky`), чтобы единообразно учитывать `env(safe-area-inset-*)` на iOS-устройствах.

## Тестирование
- Vitest-снапшоты для базовых сценариев (`App.visual.test.tsx`) фиксируют пустой чат, чат с историей и мобильное состояние.
- Запуск: `npm test` внутри каталога `frontend`. Снапшоты хранятся в `src/__tests__/__snapshots__`.

## UX-гайдлайны
- Оставляйте основное взаимодействие в пределах центральной колонки (`ChatLayout`).
- Панели и модальные окна не должны блокировать основной поток, если данные могут отображаться позже.
- Быстрые подсказки формируются в `App.tsx`; расширения логики добавляйте туда же.
